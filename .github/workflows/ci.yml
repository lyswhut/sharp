name: CI (GitHub)
on:
  - push
  - pull_request
permissions: {}
jobs:
  CI:
    permissions:
      contents: write # for npx prebuild to make release
    name: centos:7 - Node.js 16
    runs-on: ubuntu-22.04
    container: centos:7
    steps:
      - name: Dependencies (Linux glibc)
        run: |
          yum install -y https://rpm.nodesource.com/pub_16.x/nodistro/repo/nodesource-release-nodistro-1.noarch.rpm
          yum install -y https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm
          yum install -y centos-release-scl
          yum install -y devtoolset-11-gcc-c++ make git python3 nodejs fontconfig google-noto-sans-fonts
          echo "/opt/rh/devtoolset-11/root/usr/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - name: Fix working directory ownership
        run: chown root.root .
      - name: Install
        run: npm install --build-from-source --unsafe-perm
      # - name: Test
      #   run: npm test
      - name: Prebuild
        run: npx prebuild --runtime electron --target 25.0.0 --include-regex 'sharp\.node$' && ls build/Release

